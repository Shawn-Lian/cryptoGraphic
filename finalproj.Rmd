--- 
title: "cryptoGraphic"
author: "Xuan Lian"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
---
```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```

# Introduction

## What's cyrpto?

  Based on cryptography and network P2P technology, Cryptocurrencies are generated by computer programs, and then issued and circulated on the Internet. Bitcoin is regarded as the world's first and currently the most dominant digital cryptocurrency.

  According to the report from cryptocurrency tracker CoinGecko, the total market capitalization of cryptocurrencies is \$2.36 trillion, while the total market capitalization of bitcoin is $900 billion by the end of 2021. There are only 16 countries in the world with a GDP larger than Bitcoin (BTC) market value.

```{r}
BTC_2021 <- tibble(`Country Name`='Bitcoin','GDP' = 987310000000)
countries_GDP <- read_csv('countries_GDP.csv') %>%
  select(`Country Name`,`2020 [YR2020]`) %>%
  rename(GDP=`2020 [YR2020]`) %>%
  rbind(BTC_2021) %>%
  mutate(GDP = as.numeric(GDP)/1e9) %>%
  slice_max(GDP,n=20) %>%
  arrange(desc(GDP))
countries_GDP %>%
  ggplot(aes(x =fct_reorder(`Country Name`,GDP,.desc = TRUE),y=GDP,
             fill=factor(ifelse(`Country Name`=="Bitcoin","Highlighted","Normal")))) +
  geom_col() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
        legend.position = "none")+
  labs(title = "Highest BTC Market Value v.s Countries' 2020 GDP",
       x = 'Country Name',
       y = 'GDP of 2020 (current Billion USD)')
```


## Why crypto?

Unlike tradition stocks, cryptocurrencies are not backed by any assets or cash flow, the only thing driving their prices is sentiment-driven speculation. As sentiment changes, prices can  change dramatically.

Due to the nature of cryptocurrency, it has some advantages over traditional stocks.

- Availability - Crypto can be used as long as the user has internet or mobile access. Thanks to this, we can pay for products and services all over the world without having to convert currency to country-specific currency.

- No Commissions - When paying with cryptocurrencies, first of all, we avoid banks and intermediaries, so we do not incur commissions and fees for servicing bank accounts. The cryptocurrencies system is based on P2P (Peer-to-Peer), i.e. no intermediaries.

- Anonymity - we can pay primarily in cryptos for transactions we wish to be anonymous.

- No Inflation - Cryptos are created on the so called defense mechanism against inflation by setting a maximum amount of cryptos and the inability to increase it.

## Why not Crypto?

On the contrary, cryptocurrencies also have many obvious disadvantages.

- Risks - The exchange rate of cryptocurrencies is very volatile.
- No Control - Cryptos are not regulated by financial and state institutions, and there is no central bank.
- Speculative Bubble - Many critics of cryptos argue that their exchange rates are driven by the enthusiasm of internet users and do not determine the crypto's true value.
- Anonymity - This feature is both an advantage and disadvantage of cryptocurrencies. Criminals can use cryptocurrencies to fund illicit interests.
- Irreversibility of transactions - if we order a transfer to the wrong address, the transaction will not be refunded. There is also no reason for us to demand the return of cryptos.

## Our goal

Based on the characteristics of cryptocurrency, we have raised several basic questions.

- How many cryptocurrencies are there in the market?
- What are their historical prices and valuations?
- Why are cryptocurrencies suddenly so popular?

And after having the basic idea of the cryptocurrencies, we want try to doing some research on the following questions.

- Explore the development trend of cryptocurrencies from the market cap and their public attention. 

- Show how the cryptocurrencies are different from traditional financial derivatives by comparing their behavior when affected by the positive or negative factor under the same time period. 

- What factors are related to the price of cryptocurrencies? Rather than modeling, we will apply an exploratory data analysis on this question. 

<!--chapter:end:index.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data sources

- Xuan Lian is responsible for collecting the data.

## Yahoo Finance API

- The crypto and traditional stocks data  will be obtained by Yahoo Finance Website [YH Finance](https://finance.yahoo.com)

- We need following two packages to import data.

  - quantmod
  
  - TTL

Here we show the code of extracting the Bitcoin Data of the latest three days.

    install.packages('quantmod')
    install.packages('TTR')
    library('TTR')
    library('quantmod')
    df_btc <- getSymbols('BTC-USD',src='yahoo',auto.assign=FALSE)
    tail(df_btc,3)

```{r include = TRUE}
df_btc <- getSymbols('BTC-USD',src='yahoo',auto.assign=FALSE)
tail(df_btc,3)
```



## Google Trend API

To quantify the social impact of the cryptos, we use Google Trend as the measurement and retrieve Google Trends data via `gtrendsR` package.

The `gtrendsR` package is on CRAN and can be installed via
    
    install.packages("gtrendsR")

Here we show the code of retrieving and displaying the Google Trend 'interest over time' data for the keyword 'Bitcoin' in the United States.

    install.packages("gtrendsR")
    library(gtrendsR)
    Bitcoin_US_trend <- gtrends(c("Bitcoin"), geo = c("US"))
    print(tail(Bitcoin_US_trend$interest_over_time,3))

```{r}
Bitcoin_US_trend <- gtrends(c("Bitcoin"), geo = c("US"))
print(tail(Bitcoin_US_trend$interest_over_time,3))
```

## CoinMarketCap 

We are also interested in the data of the market cap of cryptocurrencies, so we will also use CoinMarketCap website to get historical market cap data of cryptocurrencies.

We will use `rvest` package to get the information from the website. We are interested in the yearly market cap data, so we get the historical snapshot at December 31th from 2016 to 2021 for the top 20 market cap cryptocurrencies and ignore the others.

    base_url = 'https://coinmarketcap.com/historical/'
    for(year in seq(2016,2021)){
      url = paste0(base_url,year,'1231')
      dt = read_html(url) %>% html_table(fill = TRUE)
      dt = dt[3][[1]] %>% 
        select(Symbol, `Market Cap`) %>%
        mutate('year' = year) %>%
        slice_head(n=20)
    if(year == 2016){crypto_market_cap = as_tibble(dt)}
    else{crypto_market_cap = rbind(crypto_market_cap,dt)}
      }

```{r}
base_url = 'https://coinmarketcap.com/historical/'

for(year in seq(2016,2021)){
  url = paste0(base_url,year,'1231')
  dt = read_html(url) %>% html_table(fill = TRUE)
  dt = dt[3][[1]] %>% select(Symbol, `Market Cap`) %>%
    mutate('year' = year) %>%
    slice_head(n=20)
  if(year == 2016){
    crypto_market_cap = as_tibble(dt)
  }
  else{
    crypto_market_cap = rbind(crypto_market_cap,dt)
  }
}
print(head(crypto_market_cap))
```


<!--chapter:end:02-data.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Data transformation


For the market cap data, the `Market Cap` variable is in character type, so we need to transform this attribute to numeric type.

    Market_cap = crypto_market_cap$`Market Cap`
    Market_cap = substr(Market_cap,2,length(Market_cap))
    Market_cap = str_replace_all(Market_cap,',','')
    options(digits=10)
    crypto_market_cap$`Market Cap` = as.numeric(Market_cap)
    
```{r}
Market_cap = crypto_market_cap$`Market Cap`
Market_cap = substr(Market_cap,2,length(Market_cap))
Market_cap = str_replace_all(Market_cap,',','')
options(digits=10)
crypto_market_cap$`Market Cap` = as.numeric(Market_cap)
head(crypto_market_cap,n=4)
```

And as we basically want the eight cryptocurrencies with the largest market cap each year. So we will get a tidy version of the data and aggregate the other cryptocurrencies.

```{r}
crypto_market_cap_1 = crypto_market_cap %>%
  arrange(`Market Cap`) %>%
  group_by(year) %>%
  slice(1:12) %>%
  group_by(year) %>%
  summarise(`Market Cap` = sum(`Market Cap`)) %>%
  mutate(Symbol='Others') %>%
  select(Symbol,`Market Cap`,year)
crypto_market_cap_2 = crypto_market_cap %>%
  arrange(desc(`Market Cap`)) %>%
  group_by(year) %>%
  slice(1:8)
crypto_market_cap_tidy = rbind(crypto_market_cap_2,crypto_market_cap_1) %>%
  arrange(year,desc(`Market Cap`))
```

<!--chapter:end:03-cleaning.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Missing values

We are going to use adjusted closing price to compare the behavior between the traditional stocks and cryptocurrencies.

For traditional stocks, due to the limitation of trading dates, OHLCV data on non-trading dates will be missing compared to cryptocurrencies, and we choose to use previous data to fill in.

We will try to figure out the problem using the daily adjusted closing price of Bitcoin and NASDAQ 100 from 2016 to 2021, here is the sample of our origin data.

```{r include = TRUE}
df_ndx <- getSymbols('^NDX',src='yahoo',auto.assign=FALSE)
date_seq = seq(as.Date("2015/12/31"), as.Date("2021/12/31"), "days")
df_ndx_1 = df_ndx[date_seq]$NDX.Adjusted
df_btc_1 = df_btc[date_seq]$`BTC-USD.Adjusted`
df_1 = df_btc_1 %>% merge(df_ndx_1)
head(df_1,5)
```

Here we plot the missing values in year 2016.

```{r}
df_2 = as_tibble(df_1) %>% 
  cbind(date = date_seq) 
tidy_df_1 = df_2 %>%
  slice(1:365) %>%
  gather(key, value, -date) %>% 
  mutate(missing = ifelse(is.na(`value`), "yes", "no")) 
ggplot(tidy_df_1, aes(x = key, y = date, fill = missing)) +
  geom_tile(color = "white") + 
  scale_fill_viridis_d() +
  scale_y_date(date_breaks = '1 month') +
  labs(title = 'Missing values in year 2016') +
  theme_bw()
df_2 = df_2 %>%
  column_to_rownames('date')
plot_missing(df_2)
```

And we will use last non-missing observation carried forward to fill missing values

```{r}
df_no_missing = df_2 %>%
  column_to_rownames('date') 
df_no_missing = setnafill(df_no_missing,'locf')
head(df_no_missing)
```

<!--chapter:end:04-missing.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Results

<!--chapter:end:05-results.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Interactive component



<!--chapter:end:06-interactive.Rmd-->

```{r include=FALSE, cache=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE
)
```
# Conclusion


<!--chapter:end:07-conclusion.Rmd-->

